<!-- Ifitwala Ed — Student Log + Follow-ups (Report Print Template) -->

<style>
	:root{
		--ifw-ink:#243b53;
		--ifw-muted:#6b7280;
		--ifw-border:#e6e8eb;

		/* Leaf theme — state colors */
		/* Completed (green) */
		--ifw-complete:#3a9d75;         /* badge/bar */
		--ifw-complete-100:#e9f5ef;     /* header wash */
		--ifw-complete-200:#d9efe7;     /* separators */

		/* In Progress (orange) */
		--ifw-progress:#d97706;
		--ifw-progress-100:#fff4e6;
		--ifw-progress-200:#f7d7a6;

		/* Open (red) */
		--ifw-open:#d64545;
		--ifw-open-100:#fdecec;
		--ifw-open-200:#f6cfcf;

		/* (kept for other accents you already use) */
		--ifw-accent:#2563eb;
		--ifw-accent-100:#e8f0fe;
	}

	/* Page + typography */
	.print-container{ margin:8px 6px; }
	.h-title{ font-size:1.15rem; font-weight:600; margin:0; color:var(--ifw-ink); letter-spacing:.2px; }
	.h-sub{ font-size:.9rem; color:var(--ifw-muted); margin-top:2px; }

	/* Cards */
	.card{
		border:1px solid var(--ifw-border);
		border-radius:.5rem;
		margin:10px 0;
		page-break-inside:avoid;
		border-left-width:6px; /* status accent */
	}
	.card-header{
		background:#f8f9fa;
		border-bottom:1px solid var(--ifw-border);
		padding:.5rem .75rem;
	}

	/* Status-aware accents */
	.card.status-open{       border-left-color:var(--ifw-open); }
	.card.status-inprogress{ border-left-color:var(--ifw-progress); }
	.card.status-completed{  border-left-color:var(--ifw-complete); }

	.card.status-open .card-header{
		background:linear-gradient(90deg,var(--ifw-open-100), #fff);
	}
	.card.status-inprogress .card-header{
		background:linear-gradient(90deg,var(--ifw-progress-100), #fff);
	}
	.card.status-completed .card-header{
		background:linear-gradient(90deg,var(--ifw-complete-100), #fff);
	}

	/* Meta row */
	.meta{
		font-size:.85rem;
		color:var(--ifw-muted);
		display:flex; flex-wrap:wrap; gap:12px;
	}
	.meta .dot::before{ content:"•"; margin:0 8px; color:#adb5bd; }
	.badge{ vertical-align:middle; }

	/* Badge palette for print view */
	.badge-success{ background-color:var(--ifw-complete) !important; color:#fff; }
	.badge-warning{ background-color:var(--ifw-progress) !important; color:#fff; }
	.badge-danger{  background-color:var(--ifw-open) !important; color:#fff; }
	.badge-secondary{ background-color:#9aa5b1 !important; color:#fff; }
	.badge-info{ background-color:#b7791f !important; color:#fff; } /* “Requires Follow-up” */
	.badge-light{
		background-color:var(--ifw-accent-100);
		color:var(--ifw-accent);
		border:1px solid var(--ifw-accent);
	}

	/* Snippets */
	.snip{ margin:.35rem 0 .25rem 0; line-height:1.25; }
	.snip .label{ font-weight:600; margin-right:.25rem; color:#495057; }

	/* Follow-ups — no inner vertical bar; use subtle top separator */
	.followups{ margin:.35rem 0 0 0; padding:0; }
	.followup-item{
		list-style:none;
		margin:.4rem 0;
		padding:.4rem .5rem .3rem .5rem;
		background:#fff;
		border-left:0;
		border-top:1px dashed var(--ifw-border);
	}
	.followups .followup-item:first-child{ border-top:0; }

	/* Tinted separators by status */
	.card.status-open       .followup-item{ border-top-color:var(--ifw-open-200); }
	.card.status-inprogress .followup-item{ border-top-color:var(--ifw-progress-200); background:#fffaf0; }
	.card.status-completed  .followup-item{ border-top-color:var(--ifw-complete-200); }

	.followup-head{ font-size:.9rem; color:#495057; display:flex; gap:10px; margin-bottom:2px; }
	.followup-body{ font-size:.95rem; }

	/* Utility */
	.text-mono{ font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
	.mb-2{ margin-bottom:.5rem; }
	.mb-0{ margin-bottom:0; }
	.small{ font-size:.875rem; }
	.text-dim{ color:var(--ifw-muted); }
	.w-100{ width:100%; }
</style>



<div class="print-container">
	<div class="mb-2">
		<div class="h-title">Student Log + Follow-ups</div>
		<div class="h-sub">
			{% var fd = filters.from_date, td = filters.to_date; %}
			{% if (fd && td) { %}Period: {{ fd }} → {{ td }}{% } %}
			{% if (filters.student) { %} &nbsp;·&nbsp; Student: {{ filters.student }}{% } %}
			{% if (filters.program) { %} &nbsp;·&nbsp; Program: {{ filters.program }}{% } %}
			{% if (filters.school) { %} &nbsp;·&nbsp; School: {{ filters.school }}{% } %}
			{% if (filters.academic_year) { %} &nbsp;·&nbsp; AY: {{ filters.academic_year }}{% } %}
			{% if (filters.log_type) { %} &nbsp;·&nbsp; Type: {{ filters.log_type }}{% } %}
			{% if (filters.follow_up_status) { %} &nbsp;·&nbsp; Status: {{ filters.follow_up_status }}{% } %}
		</div>
	</div>

	{% var has_open_card = false; var prev_follow_count = 0; %}
	{% for (var i=0; i<data.length; i++) { var r = data[i]; %}
		{% if (r.is_group) { %}
			{% if (has_open_card) { %}
				{% if (prev_follow_count > 0) { %}</ol>{% } %}
				</div></div>
			{% } %}

			{% var st = r.follow_up_status || "";
				var status_class = "status-open";
				if (st === "In Progress") status_class = "status-inprogress";
				if (st === "Completed") status_class = "status-completed";
			%}
			<div class="card {{ status_class }}">
				<div class="card-header">
					<div class="d-flex flex-wrap align-items-center w-100">
						<div class="mr-2"><span class="text-mono">{{ r.log_id }}</span></div>
						<div class="mr-2"><strong>{{ r.student_name || r.student }}</strong></div>
						<div class="mr-2 text-dim">
							{{ r.log_date }}{% if (r.log_time) { %} {{ r.log_time }}{% } %}
						</div>
						<div class="mr-2 text-dim">·</div>
						<div class="mr-2">{{ r.log_type }}</div>
						<div class="ml-auto">
							{%
								var st   = (r.follow_up_status || "").trim();
								var norm = st.toLowerCase();
								var badge = "badge-secondary";      // fallback
								if (norm === "open")        badge = "badge-danger";   // red
								if (norm === "in progress") badge = "badge-warning";  // orange
								if (norm === "completed")   badge = "badge-success";  // green
							%}
						<span class="badge {{ badge }}">{{ st || "Open" }}</span>
						<span class="badge badge-light" title="Follow-ups count">FU # {{ r.follow_up_count || 0 }}</span>

						</div>
					</div>
					<div class="meta mt-1">
						<div>Program: <strong>{{ r.program || "-" }}</strong></div>
						<div class="dot">School: <strong>{{ r.school || "-" }}</strong></div>
						<div class="dot">AY: <strong>{{ r.academic_year || "-" }}</strong></div>
						<div class="dot">Author: <strong>{{ r.author_name || "-" }}</strong></div>
						{% if (r.visibility) { %}
							<div class="dot">Visibility: <span style="font-size:1.05em">{{ r.visibility }}</span></div>
						{% } %}
						{% if (r.requires_follow_up) { %}
							<div class="dot"><span class="badge badge-info">Requires Follow-up</span></div>
						{% } %}
					</div>
				</div>

				<div class="card-body">
					<div class="snip">
						<span class="label">Log:</span>
						<span>{{ frappe.utils.escape_html(r.log_snippet || "") }}</span>
					</div>

					{% var cnt = r.follow_up_count || 0; %}
					{% if (cnt > 0) { %}
						<ol class="followups">
					{% } else { %}
						<p class="text-dim small mb-0">No follow-ups recorded.</p>
					{% } %}

					{% has_open_card = true; prev_follow_count = cnt; %}
		{% } else { %}
			<li class="followup-item">
				<div class="followup-head">
					<div><strong>{{ r.fu_date }}</strong></div>
					<div class="text-dim">by {{ r.fu_author }}</div>
				</div>
				<div class="followup-body">
					{{ frappe.utils.escape_html(r.follow_up_snippet || "") }}
				</div>
			</li>
		{% } %}

		{% if (i === data.length - 1 && has_open_card) { %}
			{% if (prev_follow_count > 0) { %}</ol>{% } %}
			</div></div>
		{% } %}
	{% } %}
</div>
