<!-- Ifitwala Ed — Student Log + Follow-ups (Report Print Template) -->

<style>
	/* Page + typography */
	.print-container{ margin:8px 6px; }
	.h-title{ font-size:1.15rem; font-weight:600; margin:0; }
	.h-sub{ font-size:.9rem; color:#6c757d; margin-top:2px; }

	/* Cards */
	.card{ border:1px solid #e5e5e5; border-radius:.5rem; margin:10px 0; page-break-inside:avoid; }
	.card-header{ background:#f8f9fa; border-bottom:1px solid #e5e5e5; padding:.5rem .75rem; }
	.card-body{ padding:.75rem; }

	/* Meta row */
	.meta{ font-size:.85rem; color:#6c757d; display:flex; flex-wrap:wrap; gap:12px; }
	.meta .dot::before{ content:"•"; margin:0 8px; color:#adb5bd; }
	.badge{ vertical-align:middle; }

	/* Snippets */
	.snip{ margin:.35rem 0 .25rem 0; line-height:1.25; }
	.snip .label{ font-weight:600; margin-right:.25rem; color:#495057; }

	/* Follow-ups */
	.followups{ margin:.35rem 0 0 0; padding:0; }
	.followup-item{ list-style:none; border-left:3px solid #dee2e6; margin:.4rem 0; padding:.25rem .5rem .25rem .75rem; }
	.followup-head{ font-size:.9rem; color:#495057; display:flex; gap:10px; margin-bottom:2px; }
	.followup-body{ font-size:.95rem; }

	/* Utility */
	.text-mono{ font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }
	.mb-2{ margin-bottom:.5rem; }
	.mb-0{ margin-bottom:0; }
	.small{ font-size:.875rem; }
	.text-dim{ color:#6c757d; }
	.w-100{ width:100%; }
</style>

<div class="print-container">
	<div class="mb-2">
		<div class="h-title">Student Log + Follow-ups</div>
		<div class="h-sub">
			{% var fd = filters.from_date, td = filters.to_date; %}
			{% if (fd && td) { %}Period: {{ fd }} → {{ td }}{% } %}
			{% if (filters.student) { %} &nbsp;·&nbsp; Student: {{ filters.student }}{% } %}
			{% if (filters.program) { %} &nbsp;·&nbsp; Program: {{ filters.program }}{% } %}
			{% if (filters.school) { %} &nbsp;·&nbsp; School: {{ filters.school }}{% } %}
			{% if (filters.academic_year) { %} &nbsp;·&nbsp; AY: {{ filters.academic_year }}{% } %}
			{% if (filters.log_type) { %} &nbsp;·&nbsp; Type: {{ filters.log_type }}{% } %}
			{% if (filters.follow_up_status) { %} &nbsp;·&nbsp; Status: {{ filters.follow_up_status }}{% } %}
		</div>
	</div>

	{% var has_open_card = false; var prev_follow_count = 0; %}
	{% for (var i=0; i<data.length; i++) { var r = data[i]; %}
		{% if (r.is_group) { %}
			{% if (has_open_card) { %}
				{% if (prev_follow_count > 0) { %}</ol>{% } %}
				</div></div>
			{% } %}

			<div class="card">
				<div class="card-header">
					<div class="d-flex flex-wrap align-items-center w-100">
						<div class="mr-2"><span class="text-mono">{{ r.log_id }}</span></div>
						<div class="mr-2"><strong>{{ r.student_name || r.student }}</strong></div>
						<div class="mr-2 text-dim">
							{{ r.log_date }}{% if (r.log_time) { %} {{ r.log_time }}{% } %}
						</div>
						<div class="mr-2 text-dim">·</div>
						<div class="mr-2">{{ r.log_type }}</div>
						<div class="ml-auto">
							{% var st = r.follow_up_status || "";
							   var badge = "badge-secondary";
							   if (st === "In Progress") badge = "badge-primary";
							   if (st === "Closed") badge = "badge-dark";
							%}
							<span class="badge {{ badge }}">{{ st || "Open" }}</span>
							<span class="badge badge-light" title="Follow-ups count">FU # {{ r.follow_up_count || 0 }}</span>
						</div>
					</div>
					<div class="meta mt-1">
						<div>Program: <strong>{{ r.program || "-" }}</strong></div>
						<div class="dot">School: <strong>{{ r.school || "-" }}</strong></div>
						<div class="dot">AY: <strong>{{ r.academic_year || "-" }}</strong></div>
						<div class="dot">Author: <strong>{{ r.author_name || "-" }}</strong></div>
						{% if (r.visibility) { %}
							<div class="dot">Visibility: <span style="font-size:1.05em">{{ r.visibility }}</span></div>
						{% } %}
						{% if (r.requires_follow_up) { %}
							<div class="dot"><span class="badge badge-info">Requires Follow-up</span></div>
						{% } %}
					</div>
				</div>

				<div class="card-body">
					<div class="snip">
						<span class="label">Log:</span>
						<span>{{ frappe.utils.escape_html(r.log_snippet || "") }}</span>
					</div>

					{% var cnt = r.follow_up_count || 0; %}
					{% if (cnt > 0) { %}
						<ol class="followups">
					{% } else { %}
						<p class="text-dim small mb-0">No follow-ups recorded.</p>
					{% } %}

					{% has_open_card = true; prev_follow_count = cnt; %}
		{% } else { %}
			<li class="followup-item">
				<div class="followup-head">
					<div><strong>{{ r.fu_date }}</strong></div>
					<div class="text-dim">by {{ r.fu_author }}</div>
				</div>
				<div class="followup-body">
					{{ frappe.utils.escape_html(r.follow_up_snippet || "") }}
				</div>
			</li>
		{% } %}

		{% if (i === data.length - 1 && has_open_card) { %}
			{% if (prev_follow_count > 0) { %}</ol>{% } %}
			</div></div>
		{% } %}
	{% } %}
</div>
