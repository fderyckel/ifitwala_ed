<!-- base_template: ifitwala_ed/templates/sp_base.html -->

{% extends "ifitwala_ed/templates/sp_base.html" %}

{% block page_title %}My Student Logs{% endblock %}

{% block content %}
	<div class="container my-4" id="student-logs-root" data-page-length="{{ page_length or 20 }}">
		<div class="d-flex align-items-center justify-content-between mb-3">
			<h3 class="mb-0">My Student Logs</h3>
			<div class="text-muted small">Student: {{ student_name }}</div>
		</div>

		<div id="log-list" class="list-group shadow-sm rounded-3">
			{% if initial_logs and initial_logs|length %}
				{% for row in initial_logs %}
					<a href="javascript:void(0)"
					   class="list-group-item list-group-item-action d-flex flex-column gap-1 student-log-row"
					   data-log-name="{{ row.name }}"
					   aria-label="{{ row.log_type }} {{ row.date }}">
						<div class="d-flex w-100 align-items-center">
							<span class="me-2 text-secondary small">{{ row.date }}</span>
							{% if row.time %}<span class="me-2 text-secondary small">{{ row.time }}</span>{% endif %}
							<strong class="me-2">{{ row.log_type }}</strong>
							{% if row.follow_up_status %}
								<span class="badge text-bg-secondary ms-auto">{{ row.follow_up_status }}</span>
							{% endif %}
						</div>
						<div class="d-flex w-100 align-items-center text-muted small">
							<span class="me-2">Author: {{ row.author_name or "-" }}</span>
							{% if row.program %}<span class="me-2">• Program: {{ row.program }}</span>{% endif %}
							{% if row.academic_year %}<span class="me-2">• Year: {{ row.academic_year }}</span>{% endif %}
							{% if row.name in unread_names %}
								<span class="badge rounded-pill text-bg-primary ms-auto" data-new-pill>NEW</span>
							{% endif %}
						</div>
					</a>
				{% endfor %}
			{% else %}
				<div class="alert alert-info mb-0">No logs available yet.</div>
			{% endif %}
		</div>

		<div class="text-center my-3">
			<button id="load-more" class="btn btn-outline-primary">Load more</button>
			<div id="load-spinner" class="spinner-border ms-2 d-none" role="status" aria-hidden="true"></div>
		</div>
	</div>

	<!-- Detail Modal -->
	<div class="modal fade" id="logModal" tabindex="-1" aria-labelledby="logModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="logModalLabel">Log Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="mb-2">
						<div class="small text-muted" id="modal-meta"></div>
						<div id="modal-badges" class="mt-2"></div>
					</div>
					<hr class="my-2">
					<div id="modal-log-html" class="student-log-html"></div>
					<div id="modal-reference" class="mt-3 small text-muted d-none"></div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block scripts %}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			if (window.ifitwala?.portal?.studentLogs?.init) {
				window.ifitwala.portal.studentLogs.init();
			}
		});
	</script>
{% endblock %}
