<!-- ifitwala_ed/website/blocks/section_carousel.html -->
{% import "ifitwala_ed/templates/includes/smart_image_macro.html" as img_macro %}
{% set content_order = "lg:order-1" if data.layout == "content_left" else "lg:order-2" %}
{% set media_order = "lg:order-2" if data.layout == "content_left" else "lg:order-1" %}

<section class="block-section-carousel">
	<div class="mx-auto max-w-6xl px-6">
		<div class="grid gap-8 lg:grid-cols-2 lg:items-center">
			<div class="{{ content_order }}">
				<h2 class="text-3xl font-semibold text-slate-900">{{ data.heading }}</h2>
				{% if data.content %}
					<div class="prose mt-4 max-w-none">
						{{ data.content | safe }}
					</div>
				{% endif %}
				{% if data.cta_label and data.cta_link %}
					<a
						href="{{ data.cta_link }}"
						class="site-cta site-cta-outline mt-6 inline-flex items-center rounded-md border border-slate-300 px-5 py-2.5 text-sm font-semibold"
					>
						{{ data.cta_label }}
					</a>
				{% endif %}
			</div>

			<div class="{{ media_order }}">
				<div
					class="relative h-[22rem] overflow-hidden rounded-2xl border border-slate-200 bg-slate-100 shadow-sm"
					data-section-carousel
					data-interval="{{ data.interval }}"
					data-autoplay="{{ data.autoplay }}"
				>
					{% for item in data.items %}
						<div class="absolute inset-0 transition-opacity duration-700 {{ 'opacity-100 z-10' if loop.index == 1 else 'opacity-0 z-0' }}" data-section-carousel-slide>
							{{ img_macro.smart_image(
								item.image.hero,
								item.image.medium,
								item.image.card,
								item.image.thumb,
								item.image.original,
								item.alt or data.heading or "Section carousel image",
								"h-full w-full object-cover",
								fallback="carousel"
							) }}
							{% if item.caption %}
								<div class="absolute bottom-4 left-4 max-w-[75%] rounded-md bg-black/55 px-3 py-2 text-sm text-white">
									{{ item.caption }}
								</div>
							{% endif %}
						</div>
					{% endfor %}

					<button
						type="button"
						class="absolute left-3 top-1/2 z-20 -translate-y-1/2 rounded-full border border-slate-200 bg-white/85 px-3 py-2 text-xs font-semibold text-slate-700"
						data-section-carousel-prev
						aria-label="Previous slide"
					>
						Prev
					</button>
					<button
						type="button"
						class="absolute right-3 top-1/2 z-20 -translate-y-1/2 rounded-full border border-slate-200 bg-white/85 px-3 py-2 text-xs font-semibold text-slate-700"
						data-section-carousel-next
						aria-label="Next slide"
					>
						Next
					</button>

					<div class="absolute bottom-3 right-3 z-20 inline-flex items-center gap-1.5 rounded-full bg-black/45 px-2 py-1">
						{% for item in data.items %}
							<button
								type="button"
								class="h-2.5 w-2.5 rounded-full bg-white/70 transition {{ 'ring-1 ring-white' if loop.index == 1 else '' }}"
								data-section-carousel-dot
								data-slide-index="{{ loop.index0 }}"
								aria-label="Go to slide {{ loop.index }}"
							></button>
						{% endfor %}
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
