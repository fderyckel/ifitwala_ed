{
  "version": 3,
  "sources": ["../../../../../apps/ifitwala_ed/ifitwala_ed/public/js/utils.js", "../../../../../apps/ifitwala_ed/ifitwala_ed/public/js/queries.js", "../../../../../apps/ifitwala_ed/ifitwala_ed/public/js/initial_setup.js"],
  "sourcesContent": ["// Copyright (c) 2025, Fran\u00E7ois de Ryckel and contributors\n// For license information, please see license.txt\n\n\nfrappe.provide(\"ifitwala_ed.utils\");\n\n$.extend(ifitwala_ed.utils, { \n  \n  get_tree_options: function (option) {\n    // get valid options for tree based on user permission & locals dict\n    let unscrub_option = frappe.model.unscrub(option);\n    let user_permission = frappe.defaults.get_user_permissions();\n    let options;\n\n    if (user_permission && user_permission[unscrub_option]) {\n      options = user_permission[unscrub_option].map((perm) => perm.doc);\n    } else {\n      options = $.map(locals[`:${unscrub_option}`], function (c) {\n        return c.name;\n      }).sort();\n    }\n\n    // filter unique values, as there may be multiple user permissions for any value\n    return options.filter((value, index, self) => self.indexOf(value) === index);\n  },\n\n  get_tree_default: function (option) {\n    // set default for a field based on user permission\n    let options = this.get_tree_options(option);\n    if (options.includes(frappe.defaults.get_default(option))) {\n      return frappe.defaults.get_default(option);\n    } else {\n      return options[0];\n    }\n  },\n});\n\nfrappe.form.link_formatters[\"Employee\"] = function (value, doc, df) {\n\treturn add_link_title(value, doc, df, \"employee_full_name\");\n};\n\n/**\n * Add a title to a link value based on the provided document and field information.\n *\n * @param {string} value - The value to add a link title to.\n * @param {Object} doc - The document object.\n * @param {Object} df - The field object.\n * @param {string} title_field - The field name for the title.\n * @returns {string} - The link value with the added title.\n */\nfunction add_link_title(value, doc, df, title_field) {\n\tif (doc && value && doc[title_field] && doc[title_field] !== value && doc[df.fieldname] === value) {\n\t\treturn value + \": \" + doc[title_field];\n\t} else if (!value && doc.doctype && doc[title_field]) {\n\t\treturn doc[title_field];\n\t} else {\n\t\treturn value;\n\t}\n}\n", "// Copyright (c) 2025, Fran\u00E7ois de Ryckel and contributors\n// For license information, please see license.txt\n\n// searches for enabled users\nfrappe.provide(\"ifitwala_ed.queries\");\n\n$.extend(ifitwala_ed.queries, {\n\tuser: function () {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\t//task: function () {\n\t//\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t//},\n\n\tcontact_query: function (doc) {\n\t\tif (frappe.dynamic_link) {\n\t\t\tif (!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tcur_frm.scroll_to_field(frappe.dynamic_link.fieldname);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name)),\n\t\t\t\t\t]),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: \"frappe.contacts.doctype.contact.contact.contact_query\",\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\torganization_contact_query: function (doc) {\n\t\tif (!doc.organization) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"organization\", doc.name))]));\n\t\t}\n\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.contact.contact.contact_query\",\n\t\t\tfilters: { link_doctype: \"Organization\", link_name: doc.organization },\n\t\t};\n\t},\n\n\taddress_query: function (doc) {\n\t\tif (frappe.dynamic_link) {\n\t\t\tif (!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tcur_frm.scroll_to_field(frappe.dynamic_link.fieldname);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name)),\n\t\t\t\t\t]),\n\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t},\n\n\torganization_address_query: function (doc) {\n\t\tif (!doc.organization) {\n\t\t\tcur_frm.scroll_to_field(\"organization\");\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Please set {0} first.\", [\n\t\t\t\t\t__(frappe.meta.get_label(doc.doctype, \"organization\", doc.name)),\n\t\t\t\t]),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tquery: \"frappe.contacts.doctype.address.address.address_query\",\n\t\t\tfilters: { link_doctype: \"Organization\", link_name: doc.organization },\n\t\t};\n\t},\n\n\tnot_a_group_filter: function () {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function () {\n\t\treturn { query: \"ifitwala_ed.controllers.queries.employee_query\" };\n\t},\n\n\tlocation: function (doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Location\", \"organization\", \"in\", [\"\", cstr(doc.organization)]],\n\t\t\t\t[\"Location\", \"is_group\", \"=\", 0],\n\t\t\t],\n\t\t};\n\t},\n});\n\nifitwala_ed.queries.setup_queries = function (frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function (doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name, {\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: options,\n\t\t});\n\t\t$.each(link_fields, function (i, df) {\n\t\t\tif (parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(\n\t\tfrappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, { fieldtype: \"Table\" }),\n\t\tfunction (i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t}\n\t);\n};\n\n", "// Copyright (c) 2025, Fran\u00E7ois de Ryckel and contributors\n// For license information, please see license.txt\n\nfrappe.after_ajax(() => {\n  frappe.call('ifitwala_ed.setup.initial_setup.is_setup_done')\n    .then(r => {\n      if (r.message) return;  // already set up\n\n      // Prompt fields\n      const fields = [\n        {fieldtype:'Data', label:'Organization Name', fieldname:'org_name', reqd:1},\n        {fieldtype:'Data', label:'Organization Abbreviation', fieldname:'org_abbr', reqd:1},\n        {fieldtype:'Section Break'},\n        {fieldtype:'Data', label:'Top School Name', fieldname:'school_name', reqd:1},\n        {fieldtype:'Data', label:'Top School Abbreviation', fieldname:'school_abbr', reqd:1},\n      ];\n\n      frappe.prompt(fields, (values) => {\n        frappe.call({\n          method:'ifitwala_ed.setup.initial_setup.complete_initial_setup',\n          args: values,\n          callback: () => {\n            frappe.show_alert(__('Initial setup completed!'), 5);\n            setTimeout(() => location.reload(), 1200);\n          }\n        });\n      }, __(\"Ifitwala\u00A0Ed \u2013\u00A0initial setup\"), __('Create'));\n    });\n});\n"],
  "mappings": "MAIA,OAAO,QAAQ,mBAAmB,EAElC,EAAE,OAAO,YAAY,MAAO,CAE1B,iBAAkB,SAAUA,EAAQ,CAElC,IAAIC,EAAiB,OAAO,MAAM,QAAQD,CAAM,EAC5CE,EAAkB,OAAO,SAAS,qBAAqB,EACvDC,EAEJ,OAAID,GAAmBA,EAAgBD,GACrCE,EAAUD,EAAgBD,GAAgB,IAAKG,GAASA,EAAK,GAAG,EAEhED,EAAU,EAAE,IAAI,OAAO,IAAIF,KAAmB,SAAUI,EAAG,CACzD,OAAOA,EAAE,IACX,CAAC,EAAE,KAAK,EAIHF,EAAQ,OAAO,CAACG,EAAOC,EAAOC,IAASA,EAAK,QAAQF,CAAK,IAAMC,CAAK,CAC7E,EAEA,iBAAkB,SAAUP,EAAQ,CAElC,IAAIG,EAAU,KAAK,iBAAiBH,CAAM,EAC1C,OAAIG,EAAQ,SAAS,OAAO,SAAS,YAAYH,CAAM,CAAC,EAC/C,OAAO,SAAS,YAAYA,CAAM,EAElCG,EAAQ,EAEnB,CACF,CAAC,EAED,OAAO,KAAK,gBAAgB,SAAc,SAAUG,EAAOG,EAAKC,EAAI,CACnE,OAAOC,EAAeL,EAAOG,EAAKC,EAAI,oBAAoB,CAC3D,EAWA,SAASC,EAAeL,EAAOG,EAAKC,EAAIE,EAAa,CACpD,OAAIH,GAAOH,GAASG,EAAIG,IAAgBH,EAAIG,KAAiBN,GAASG,EAAIC,EAAG,aAAeJ,EACpFA,EAAQ,KAAOG,EAAIG,GAChB,CAACN,GAASG,EAAI,SAAWA,EAAIG,GAChCH,EAAIG,GAEJN,CAET,CCtDA,OAAO,QAAQ,qBAAqB,EAEpC,EAAE,OAAO,YAAY,QAAS,CAC7B,KAAM,UAAY,CACjB,MAAO,CAAE,MAAO,0CAA2C,CAC5D,EAMA,cAAe,SAAUO,EAAK,CAC7B,GAAI,OAAO,aACV,OAAKA,EAAI,OAAO,aAAa,aAC5B,QAAQ,gBAAgB,OAAO,aAAa,SAAS,EACrD,OAAO,WAAW,CACjB,QAAS,GAAG,wBAAyB,CACpC,GAAG,OAAO,KAAK,UAAUA,EAAI,QAAS,OAAO,aAAa,UAAWA,EAAI,IAAI,CAAC,CAC/E,CAAC,EACD,UAAW,QACZ,CAAC,GAGK,CACN,MAAO,wDACP,QAAS,CACR,aAAc,OAAO,aAAa,QAClC,UAAWA,EAAI,OAAO,aAAa,UACpC,CACD,CAEF,EAEA,2BAA4B,SAAUA,EAAK,CAC1C,OAAKA,EAAI,cACR,OAAO,MAAM,GAAG,iBAAkB,CAAC,GAAG,OAAO,KAAK,UAAUA,EAAI,QAAS,eAAgBA,EAAI,IAAI,CAAC,CAAC,CAAC,CAAC,EAG/F,CACN,MAAO,wDACP,QAAS,CAAE,aAAc,eAAgB,UAAWA,EAAI,YAAa,CACtE,CACD,EAEA,cAAe,SAAUA,EAAK,CAC7B,GAAI,OAAO,aACV,OAAKA,EAAI,OAAO,aAAa,aAC5B,QAAQ,gBAAgB,OAAO,aAAa,SAAS,EACrD,OAAO,WAAW,CACjB,QAAS,GAAG,wBAAyB,CACpC,GAAG,OAAO,KAAK,UAAUA,EAAI,QAAS,OAAO,aAAa,UAAWA,EAAI,IAAI,CAAC,CAC/E,CAAC,EACD,UAAW,QACZ,CAAC,GAGK,CACN,MAAO,wDACP,QAAS,CACR,aAAc,OAAO,aAAa,QAClC,UAAWA,EAAI,OAAO,aAAa,UACpC,CACD,CAEF,EAEA,2BAA4B,SAAUA,EAAK,CAC1C,OAAKA,EAAI,eACR,QAAQ,gBAAgB,cAAc,EACtC,OAAO,WAAW,CACjB,QAAS,GAAG,wBAAyB,CACpC,GAAG,OAAO,KAAK,UAAUA,EAAI,QAAS,eAAgBA,EAAI,IAAI,CAAC,CAChE,CAAC,EACD,UAAW,QACZ,CAAC,GAGK,CACN,MAAO,wDACP,QAAS,CAAE,aAAc,eAAgB,UAAWA,EAAI,YAAa,CACtE,CACD,EAEA,mBAAoB,UAAY,CAC/B,MAAO,CAAE,QAAS,CAAE,SAAU,CAAE,CAAE,CACnC,EAEA,SAAU,UAAY,CACrB,MAAO,CAAE,MAAO,gDAAiD,CAClE,EAEA,SAAU,SAAUA,EAAK,CACxB,MAAO,CACN,QAAS,CACR,CAAC,WAAY,eAAgB,KAAM,CAAC,GAAI,KAAKA,EAAI,YAAY,CAAC,CAAC,EAC/D,CAAC,WAAY,WAAY,IAAK,CAAC,CAChC,CACD,CACD,CACD,CAAC,EAED,YAAY,QAAQ,cAAgB,SAAUC,EAAKC,EAASC,EAAU,CACrE,IAAIC,EAAK,KACLC,EAAY,SAAUC,EAASC,EAAa,CAC/C,IAAIC,EAAc,OAAO,KAAK,cAAcF,EAASL,EAAI,IAAI,KAAM,CAClE,UAAW,OACX,QAASC,CACV,CAAC,EACD,EAAE,KAAKM,EAAa,SAAUC,EAAGC,EAAI,CAChCH,EACHN,EAAI,UAAUS,EAAG,UAAWH,EAAaJ,CAAQ,EAEjDF,EAAI,UAAUS,EAAG,UAAWP,CAAQ,CAEtC,CAAC,CACF,EAEAE,EAAUJ,EAAI,IAAI,OAAO,EAGzB,EAAE,KACD,OAAO,KAAK,cAAcA,EAAI,IAAI,QAASA,EAAI,IAAI,KAAM,CAAE,UAAW,OAAQ,CAAC,EAC/E,SAAUQ,EAAGC,EAAI,CAChBL,EAAUK,EAAG,QAASA,EAAG,SAAS,CACnC,CACD,CACD,EC/HA,OAAO,WAAW,IAAM,CACtB,OAAO,KAAK,+CAA+C,EACxD,KAAKC,GAAK,CACT,GAAIA,EAAE,QAAS,OAGf,IAAMC,EAAS,CACb,CAAC,UAAU,OAAQ,MAAM,oBAAqB,UAAU,WAAY,KAAK,CAAC,EAC1E,CAAC,UAAU,OAAQ,MAAM,4BAA6B,UAAU,WAAY,KAAK,CAAC,EAClF,CAAC,UAAU,eAAe,EAC1B,CAAC,UAAU,OAAQ,MAAM,kBAAmB,UAAU,cAAe,KAAK,CAAC,EAC3E,CAAC,UAAU,OAAQ,MAAM,0BAA2B,UAAU,cAAe,KAAK,CAAC,CACrF,EAEA,OAAO,OAAOA,EAASC,GAAW,CAChC,OAAO,KAAK,CACV,OAAO,yDACP,KAAMA,EACN,SAAU,IAAM,CACd,OAAO,WAAW,GAAG,0BAA0B,EAAG,CAAC,EACnD,WAAW,IAAM,SAAS,OAAO,EAAG,IAAI,CAC1C,CACF,CAAC,CACH,EAAG,GAAG,wCAA6B,EAAG,GAAG,QAAQ,CAAC,CACpD,CAAC,CACL,CAAC",
  "names": ["option", "unscrub_option", "user_permission", "options", "perm", "c", "value", "index", "self", "doc", "df", "add_link_title", "title_field", "doc", "frm", "options", "query_fn", "me", "set_query", "doctype", "parentfield", "link_fields", "i", "df", "r", "fields", "values"]
}
