(()=>{frappe.provide("ifitwala_ed.utils");$.extend(ifitwala_ed.utils,{get_tree_options:function(e){let a=frappe.model.unscrub(e),t=frappe.defaults.get_user_permissions(),i;return t&&t[a]?i=t[a].map(n=>n.doc):i=$.map(locals[`:${a}`],function(n){return n.name}).sort(),i.filter((n,o,r)=>r.indexOf(n)===o)},get_tree_default:function(e){let a=this.get_tree_options(e);return a.includes(frappe.defaults.get_default(e))?frappe.defaults.get_default(e):a[0]}});frappe.form.link_formatters.Employee=function(e,a,t){return f(e,a,t,"employee_full_name")};function f(e,a,t,i){return a&&e&&a[i]&&a[i]!==e&&a[t.fieldname]===e?e+": "+a[i]:!e&&a.doctype&&a[i]?a[i]:e}frappe.provide("ifitwala_ed.queries");$.extend(ifitwala_ed.queries,{user:function(){return{query:"frappe.core.doctype.user.user.user_query"}},contact_query:function(e){if(frappe.dynamic_link)return e[frappe.dynamic_link.fieldname]||(cur_frm.scroll_to_field(frappe.dynamic_link.fieldname),frappe.show_alert({message:__("Please set {0} first.",[__(frappe.meta.get_label(e.doctype,frappe.dynamic_link.fieldname,e.name))]),indicator:"orange"})),{query:"frappe.contacts.doctype.contact.contact.contact_query",filters:{link_doctype:frappe.dynamic_link.doctype,link_name:e[frappe.dynamic_link.fieldname]}}},organization_contact_query:function(e){return e.organization||frappe.throw(__("Please set {0}",[__(frappe.meta.get_label(e.doctype,"organization",e.name))])),{query:"frappe.contacts.doctype.contact.contact.contact_query",filters:{link_doctype:"Organization",link_name:e.organization}}},address_query:function(e){if(frappe.dynamic_link)return e[frappe.dynamic_link.fieldname]||(cur_frm.scroll_to_field(frappe.dynamic_link.fieldname),frappe.show_alert({message:__("Please set {0} first.",[__(frappe.meta.get_label(e.doctype,frappe.dynamic_link.fieldname,e.name))]),indicator:"orange"})),{query:"frappe.contacts.doctype.address.address.address_query",filters:{link_doctype:frappe.dynamic_link.doctype,link_name:e[frappe.dynamic_link.fieldname]}}},organization_address_query:function(e){return e.organization||(cur_frm.scroll_to_field("organization"),frappe.show_alert({message:__("Please set {0} first.",[__(frappe.meta.get_label(e.doctype,"organization",e.name))]),indicator:"orange"})),{query:"frappe.contacts.doctype.address.address.address_query",filters:{link_doctype:"Organization",link_name:e.organization}}},not_a_group_filter:function(){return{filters:{is_group:0}}},employee:function(){return{query:"ifitwala_ed.controllers.queries.employee_query"}},location:function(e){return{filters:[["Location","organization","in",["",cstr(e.organization)]],["Location","is_group","=",0]]}}});ifitwala_ed.queries.setup_queries=function(e,a,t){var i=this,n=function(o,r){var l=frappe.meta.get_docfields(o,e.doc.name,{fieldtype:"Link",options:a});$.each(l,function(s,p){r?e.set_query(p.fieldname,r,t):e.set_query(p.fieldname,t)})};n(e.doc.doctype),$.each(frappe.meta.get_docfields(e.doc.doctype,e.doc.name,{fieldtype:"Table"}),function(o,r){n(r.options,r.fieldname)})};frappe.after_ajax(()=>{frappe.call("ifitwala_ed.setup.initial_setup.is_setup_done").then(e=>{if(e.message)return;let a=[{fieldtype:"Data",label:"Organization Name",fieldname:"org_name",reqd:1},{fieldtype:"Data",label:"Organization Abbreviation",fieldname:"org_abbr",reqd:1},{fieldtype:"Section Break"},{fieldtype:"Data",label:"Top School Name",fieldname:"school_name",reqd:1},{fieldtype:"Data",label:"Top School Abbreviation",fieldname:"school_abbr",reqd:1}];frappe.prompt(a,t=>{frappe.call({method:"ifitwala_ed.setup.initial_setup.complete_initial_setup",args:t,callback:()=>{frappe.show_alert(__("Initial setup completed!"),5),setTimeout(()=>location.reload(),1200)}})},__("Ifitwala\xA0Ed \u2013\xA0initial setup"),__("Create"))})});})();
//# sourceMappingURL=ifitwala_ed.bundle.M6EKNBJ6.js.map
