<!-- Medical Info & Emergency Contact Report Print -->

<style>
	:root{
		--ink:#1f2a37;
		--muted:#6b7280;
		--border:#e5e7eb;
		--accent:#16a34a;
		--med-border:#f87171;
	}

	.print-shell{ margin:10px 12px; font-size:0.95rem; color:var(--ink); }
	.h-title{ font-size:1.45rem; font-weight:700; margin:0; }
	.h-sub{ font-size:0.92rem; color:var(--muted); }
	.meta-stack{ margin-top:8px; margin-bottom:24px; line-height:1.4; }

	.cards-wrapper{ display:flex; flex-direction:column; gap:18px; }

	.card{
		border:1px solid var(--border);
		border-radius:12px;
		padding:0;
		page-break-inside:avoid;
		overflow:hidden;
	}

	.card-head{
		padding:12px 16px;
		border-bottom:1px solid var(--border);
		display:flex;
		align-items:center;
		gap:16px;
		background:linear-gradient(90deg,rgba(22,163,74,.08),#fff);
	}
	.card-head-main{ flex:1; min-width:0; }
	.card-head .name{ font-size:1.15rem; font-weight:600; margin-bottom:4px; }
	.card-head .meta{
		font-size:0.85rem;
		color:var(--muted);
		display:flex;
		gap:12px;
		flex-wrap:wrap;
	}
	.card-photo{
		width:64px;
		height:64px;
		border-radius:50%;
		overflow:hidden;
		border:2px solid #fff;
		box-shadow:0 1px 4px rgba(0,0,0,.12);
		flex-shrink:0;
		background:#f8fafc;
	}
	.card-photo img{
		width:100%;
		height:100%;
		object-fit:cover;
		display:block;
	}

	.card-body{ padding:16px 18px; display:flex; flex-direction:column; gap:16px; }
	.section-title{
		font-size:0.92rem;
		font-weight:700;
		text-transform:uppercase;
		letter-spacing:0.04em;
		margin-bottom:6px;
		color:#1f2937;
	}

	.med-box{
		border:2px solid var(--med-border);
		border-radius:14px;
		background:rgba(248,113,113,.06);
		padding:12px 14px;
	}
	.med-line{ margin-bottom:4px; line-height:1.35; }
	.med-label{ font-weight:600; color:#374151; margin-right:4px; }

	.guardian-block{
		padding:10px 12px;
		border:1px solid var(--border);
		border-radius:10px;
		margin-bottom:10px;
		background:#fff;
	}
	.gc-head{ font-weight:600; margin-bottom:4px; }
	.gc-relation{ color:var(--muted); font-weight:400; }
	.gc-line{ font-size:0.9rem; line-height:1.3; }
	.gc-label{ font-weight:600; margin-right:4px; }
	.guardian-divider{
		border:none;
		border-top:1px dashed var(--border);
		margin:10px 0;
	}

	.text-muted{ color:var(--muted); }
</style>

<div class="print-shell">
	{% var first = (data && data.length) ? data[0] : null; %}
	{% var groupLabel = first ? (first._group_label || filters.student_group) : (filters.student_group || __("N/A")); %}
	{% var programLabel = first ? (first._program_label || first._program) : filters.program; %}
	{% var schoolLabel = first ? (first._school_label || first._school) : filters.school; %}
	{% var ayLabel = first ? first._academic_year : ""; %}
	{% var generatedOn = frappe.datetime.str_to_user(frappe.datetime.now_datetime()); %}

	<div class="h-title">{{ __("Student's Medical Info & Emergency Contacts") }}</div>
	<div class="meta-stack">
		<div class="h-sub">
			{{ __("Student Group") }}: {{ frappe.utils.escape_html(groupLabel || __("N/A")) }}
			{% if (programLabel) { %} &nbsp;·&nbsp; {{ __("Program") }}: {{ frappe.utils.escape_html(programLabel) }}{% } %}
			{% if (schoolLabel) { %} &nbsp;·&nbsp; {{ __("School") }}: {{ frappe.utils.escape_html(schoolLabel) }}{% } %}
			{% if (ayLabel) { %} &nbsp;·&nbsp; {{ __("AY") }}: {{ frappe.utils.escape_html(ayLabel) }}{% } %}
			{% if (data && data.length) { %} &nbsp;·&nbsp; {{ __("Students") }}: {{ data.length }}{% } %}
		</div>
		<div class="h-sub">{{ __("Generated On") }}: {{ frappe.utils.escape_html(generatedOn) }}</div>
	</div>

	{% if (!data || !data.length) { %}
		<p class="text-muted">{{ __("No active students found for this student group.") }}</p>
	{% } %}

	<div class="cards-wrapper">
	{% for (var i = 0; i < (data || []).length; i++) { var row = data[i]; %}
		<div class="card">
			<div class="card-head">
				<div class="card-head-main">
					<div class="name">{{ frappe.utils.escape_html(row.student_name || row.student) }}</div>
					<div class="meta">
						<span>{{ __("ID") }}: {{ frappe.utils.escape_html(row.student || "—") }}</span>
						<span>{{ __("Age") }}: {{ row.age || __("N/A") }}</span>
					</div>
				</div>
				{% if (row._student_image) { %}
					<div class="card-photo">
						<img src="{{ frappe.utils.escape_html(row._student_image) }}" alt="{{ frappe.utils.escape_html(row.student_name || row.student) }}">
					</div>
				{% } %}
			</div>
			<div class="card-body">
				<div>
					<div class="section-title">{{ __("Medical Information") }}</div>
					<div class="med-box">
						{% if (row.medical_summary) { %}
							<div class="med-lines">{{ row.medical_summary }}</div>
						{% } else { %}
							<p class="text-muted" style="margin:0;">{{ __("No medical information provided.") }}</p>
						{% } %}
					</div>
				</div>
				<div>
					<div class="section-title">{{ __("Guardian Contacts") }}</div>
					{% if (row.guardian_contacts) { %}
						<div class="guardian-lines">{{ row.guardian_contacts }}</div>
					{% } else { %}
						<p class="text-muted" style="margin:0;">{{ __("No guardian contacts recorded.") }}</p>
					{% } %}
				</div>
			</div>
		</div>
	{% } %}
	</div>
</div>
