<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>
		Team Meeting Book –
		{{ team.team_name or team.name }}
	</title>
	<style>
		body {
			font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
			font-size: 14px;
			color: #0f172a;
			margin: 0;
			padding: 24px;
			background: #f8fafc;
		}
		header {
			margin-bottom: 24px;
			padding-bottom: 16px;
			border-bottom: 1px solid #e2e8f0;
		}
		.header-title {
			font-size: 20px;
			font-weight: 600;
			margin-bottom: 4px;
		}
		.header-meta {
			font-size: 13px;
			color: #64748b;
		}
		.header-meta span + span::before {
			content: "•";
			margin: 0 6px;
			color: #cbd5f5;
		}
		.filter-row {
			margin-top: 8px;
			font-size: 12px;
			color: #6b7280;
		}
		.badge {
			display: inline-block;
			padding: 2px 6px;
			border-radius: 999px;
			font-size: 11px;
			background: #e5e7eb;
			color: #374151;
		}
		.meeting-count {
			margin-top: 8px;
			font-size: 12px;
			color: #4b5563;
		}
		.hint-print {
			margin-top: 4px;
			font-size: 11px;
			color: #9ca3af;
		}
		.meeting-block {
			background: #ffffff;
			border-radius: 12px;
			border: 1px solid #e5e7eb;
			padding: 16px 18px;
			margin-bottom: 16px;
			page-break-inside: avoid;
		}
		.meeting-title {
			font-size: 16px;
			font-weight: 600;
			margin: 0 0 4px 0;
		}
		.meeting-meta {
			font-size: 12px;
			color: #6b7280;
		}
		.meeting-meta span + span::before {
			content: "•";
			margin: 0 6px;
			color: #d1d5db;
		}
		.meeting-section-title {
			font-size: 13px;
			font-weight: 600;
			margin: 12px 0 4px 0;
		}
		.meeting-agenda,
		.meeting-minutes {
			font-size: 13px;
			color: #111827;
		}
		.meeting-participants {
			font-size: 12px;
			color: #4b5563;
			margin-top: 6px;
		}
		.meeting-participants strong {
			font-weight: 600;
		}
		.meeting-participant-pill {
			display: inline-block;
			padding: 2px 6px;
			border-radius: 999px;
			background: #eff6ff;
			color: #1d4ed8;
			font-size: 11px;
			margin: 2px 4px 2px 0;
		}
		.meeting-participant-pill span {
			color: #6b7280;
		}
		.meeting-action-items {
			width: 100%;
			border-collapse: collapse;
			font-size: 12px;
		}
		.meeting-action-items th,
		.meeting-action-items td {
			border: 1px solid #e5e7eb;
			padding: 4px 6px;
			vertical-align: top;
		}
		.meeting-action-items th {
			background: #f3f4f6;
			font-weight: 600;
			text-align: left;
		}
		.meeting-empty {
			padding: 24px;
			background: #ffffff;
			border-radius: 12px;
			border: 1px dashed #d1d5db;
			color: #6b7280;
			font-size: 13px;
		}
		@media print {
			body {
				background: #ffffff;
				margin: 0;
				padding: 16px;
			}
			header {
				position: relative;
				page-break-after: avoid;
			}
			.meeting-block {
				page-break-inside: auto;
			}
		}
	</style>
</head>
<body>
	<header>
		<div class="header-title">
			{{ _("Team Meeting Book") }} – {{ team.team_name or team.name }}
		</div>
		<div class="header-meta">
			{% if team.school %}
				<span>{{ _("School") }}: {{ team.school }}</span>
			{% endif %}
			{% if team.organization %}
				<span>{{ _("Organization") }}: {{ team.organization }}</span>
			{% endif %}
			<span>{{ _("Generated on") }} {{ generated_on }} {{ _("by") }} {{ generated_by }}</span>
		</div>

		<div class="filter-row">
			{% if academic_year %}
				<span class="badge">
					{{ _("Academic Year") }}: {{ academic_year.academic_year_name or academic_year.name }}
				</span>
			{% elif from_date or to_date %}
				<span class="badge">
					{{ _("Date range") }}:
					{% if from_date %}{{ from_date }}{% endif %}
					{% if from_date and to_date %} → {% endif %}
					{% if to_date %}{{ to_date }}{% endif %}
				</span>
			{% else %}
				<span class="badge">
					{{ _("Filter") }}: {{ _("All non-cancelled meetings") }}
				</span>
			{% endif %}
		</div>

		<div class="meeting-count">
			{% if meetings %}
				{{ _("{0} meeting(s) in this view").format(meetings|length) }}
			{% else %}
				{{ _("No visible meetings for this filter.") }}
			{% endif %}
		</div>

		<div class="hint-print">
			{{ _("Tip: Use your browser’s Print → Save as PDF to archive or share this record.") }}
		</div>
	</header>

	{% if not meetings %}
		<div class="meeting-empty">
			{{ _("There are no meetings available for this team and filter. Check date / year filters or meeting visibility.") }}
		</div>
	{% else %}
		{% for m in meetings %}
			<article class="meeting-block">
				<h2 class="meeting-title">
					{{ m.title }}
					{% if m.code %}
						<span style="font-size:11px; color:#9ca3af; margin-left:4px;">
							({{ m.code }})
						</span>
					{% endif %}
				</h2>
				<div class="meeting-meta">
					{% if m.date_label %}
						<span>{{ m.date_label }}</span>
					{% endif %}
					{% if m.time_range %}
						<span>{{ m.time_range }}</span>
					{% endif %}
					{% if m.category %}
						<span>{{ m.category }}</span>
					{% endif %}
					{% if m.status %}
						<span>{{ m.status }}</span>
					{% endif %}
					{% if m.location %}
						<span>{{ _("Location") }}: {{ m.location }}</span>
					{% endif %}
				</div>

				{% set plist = participants_by_meeting.get(m.name) or [] %}
				{% if plist %}
					<div class="meeting-participants">
						<strong>{{ _("Participants") }}:</strong>
						<br>
						{% for p in plist %}
							<span class="meeting-participant-pill">
								{{ p.name }}
								{% if p.role %}
									<span>· {{ p.role }}</span>
								{% endif %}
								{% if p.attendance and p.attendance != "Pending" %}
									<span>· {{ p.attendance }}</span>
								{% endif %}
							</span>
						{% endfor %}
					</div>
				{% endif %}

				{% if m.agenda %}
					<h3 class="meeting-section-title">{{ _("Agenda") }}</h3>
					<div class="meeting-agenda">
						{{ m.agenda | safe }}
					</div>
				{% endif %}

				{% if m.minutes %}
					<h3 class="meeting-section-title">{{ _("Minutes") }}</h3>
					<div class="meeting-minutes">
						{{ m.minutes | safe }}
					</div>
				{% endif %}

				{% set items = action_items_by_meeting.get(m.name) or [] %}
				{% if items %}
					<h3 class="meeting-section-title">{{ _("Action Items") }}</h3>
					<table class="meeting-action-items">
						<thead>
							<tr>
								<th style="width:55%;">{{ _("Description") }}</th>
								<th style="width:25%;">{{ _("Owner") }}</th>
								<th style="width:10%;">{{ _("Due") }}</th>
								<th style="width:10%;">{{ _("Status") }}</th>
							</tr>
						</thead>
						<tbody>
							{% for ai in items %}
								<tr>
									<<td>{{ ai.description | safe }}</td>
									<td>{{ ai.owner or "-" }}</td>
									<td>{{ ai.due_date or "-" }}</td>
									<td>{{ ai.status or "-" }}</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				{% endif %}
			</article>
		{% endfor %}
	{% endif %}
</body>
</html>
