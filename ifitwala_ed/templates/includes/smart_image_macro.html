{#
  smart_image macro
  Outputs <img> tag with fallback sources for JS-based progressive image loading
  Arguments:
    - large: optional large src (for carousel)
    - medium: optional medium src
    - original: always required fallback original src
    - alt: alt text
    - class: CSS classes
    - fallback: 'carousel' (default) or 'card' â†’ determines which fallback chain to include
#}

{% macro smart_image(large=None, medium=None, original=None, alt='', class='', fallback='card') %}
  {% set src = large if fallback == 'carousel' else medium if fallback == 'card' else original %}
  <img
    src="{{ src or original }}"
    {% if fallback == 'carousel' and medium %} data-src-medium="{{ medium }}"{% endif %}
    {% if fallback in ['carousel', 'card'] and original %} data-src-original="{{ original }}"{% endif %}
    alt="{{ alt }}"
    class="{{ class }}"
    loading="lazy"
    fallback="{{ fallback }}">
{% endmacro %}