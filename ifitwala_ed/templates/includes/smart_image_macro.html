{#
  smart_image_macro.html
  Universal macro to insert fallback-ready <img> elements
  - Uses data-src-* attributes to enable JS-driven fallback (defined in image_fallback.js)
  - Requires: include image_fallback.js in your <head> and load macro with {% import ... as ... %}
  - Usage:
    {{ img_macro.smart_image(img.large, img.medium, img.original, img.caption, 'class-list') }}
#}

{% macro smart_image(large, medium, original, alt, css_class='') %}
  <img
    src="{{ medium or original }}"
    data-src-large="{{ large }}"
    data-src-medium="{{ medium }}"
    data-src-original="{{ original }}"
    alt="{{ alt or 'Image' }}"
    loading="lazy"
    class="{{ css_class }}"
    onerror="this.onerror=null;this.src=this.dataset.srcMedium || this.dataset.srcOriginal;"
  >
{% endmacro %}